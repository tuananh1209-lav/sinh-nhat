<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Birthday üíñ</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --pink:#ff77b7;
      --pink2:#ffd1e7;
      --sky:#7bd3ff;
      --sun:#ffd86b;
      --ink:#2b2b2b;
      --card: rgba(255,255,255,.78);
      --shadow: 0 18px 45px rgba(0,0,0,.12);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Quicksand", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      overflow-x:hidden;
      background:
        radial-gradient(1200px 700px at 15% 20%, rgba(255, 119, 183,.35), transparent 55%),
        radial-gradient(900px 600px at 85% 15%, rgba(123, 211, 255,.35), transparent 55%),
        radial-gradient(900px 700px at 70% 85%, rgba(255, 216, 107,.35), transparent 55%),
        linear-gradient(135deg, #ffe1f1, #e7f6ff);
    }

    .sparkle {
      position: fixed;
      inset: -20vh -20vw;
      pointer-events:none;
      background-image:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,.7) 0 2px, transparent 3px),
        radial-gradient(circle at 70% 40%, rgba(255,255,255,.6) 0 1.5px, transparent 3px),
        radial-gradient(circle at 40% 80%, rgba(255,255,255,.55) 0 1.8px, transparent 3px),
        radial-gradient(circle at 85% 75%, rgba(255,255,255,.55) 0 1.4px, transparent 3px);
      background-size: 320px 320px;
      animation: drift 18s linear infinite;
      opacity:.6;
      filter: blur(.2px);
    }
    @keyframes drift{
      from{transform: translate3d(0,0,0)}
      to{transform: translate3d(-220px, -180px, 0)}
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 26px 16px 40px;
      position:relative;
    }

    .frame{
      width:min(980px, 100%);
      border-radius: 26px;
      background: linear-gradient(180deg, rgba(255,255,255,.6), rgba(255,255,255,.35));
      border: 1px solid rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 16px 18px;
      background: linear-gradient(90deg, rgba(255,119,183,.18), rgba(123,211,255,.18), rgba(255,216,107,.18));
      border-bottom:1px solid rgba(255,255,255,.6);
    }
    .brand{
      display:flex; gap:10px; align-items:center;
      font-weight:800;
    }
    .dot{
      width:12px;height:12px;border-radius:50%;
      background: var(--pink);
      box-shadow: 0 0 0 6px rgba(255,119,183,.15);
    }
    .mini{
      font-size: 12px;
      opacity:.85;
      display:flex; gap:10px; align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.55);
      border:1px solid rgba(255,255,255,.65);
      white-space:nowrap;
    }

    .content{ padding: 22px; }
    .screen{display:none}
    .screen.active{display:block}

    .hero{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:18px;
      align-items:center;
    }
    .hero.oneCol{ grid-template-columns: 1fr; }

    @media (max-width: 860px){ .hero{grid-template-columns:1fr} }

    h1.title{
      font-family: "Pacifico", cursive;
      font-size: clamp(34px, 4.6vw, 54px);
      margin: 0 0 10px;
      color:#ff3f9f;
      text-shadow: 0 12px 30px rgba(255,63,159,.18);
      line-height:1.12;
    }

    .lead{
      font-size: 16.5px;
      line-height: 1.8;
      margin:0 0 18px;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(255,255,255,.6);
      padding: 14px 14px;
      border-radius: 18px;
    }

    .card{
      border-radius: 22px;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(255,255,255,.65);
      box-shadow: 0 16px 30px rgba(0,0,0,.08);
      overflow:hidden;
      position:relative;
    }
    .card .pad{padding:16px}

    .btnRow{display:flex; gap:10px; flex-wrap:wrap}
    button{
      border:0;
      border-radius: 14px;
      padding: 12px 14px;
      font-family: inherit;
      font-weight: 800;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
      box-shadow: 0 14px 30px rgba(0,0,0,.12);
    }
    button:active{transform: translateY(1px) scale(.99)}
    .btnPrimary{
      background: linear-gradient(135deg, var(--pink), #ff4ea6);
      color:white;
    }
    .btnSoft{
      background: linear-gradient(135deg, rgba(123,211,255,.65), rgba(255,216,107,.55));
      color:#1d1d1d;
      box-shadow: 0 14px 30px rgba(0,0,0,.10);
    }
    .btnGhost{
      background: rgba(255,255,255,.6);
      border:1px solid rgba(255,255,255,.75);
      box-shadow:none;
      color:#333;
    }

    /* Video stage */
    .stage{
      display:grid;
      grid-template-columns: 1fr .9fr;
      gap: 14px;
      align-items:stretch;
    }
    @media (max-width: 860px){ .stage{grid-template-columns:1fr} }

    .videoWrap{
      position:relative;
      border-radius: 24px;
      overflow:hidden;
      background:
        radial-gradient(1200px 700px at 20% 20%, rgba(255,119,183,.20), transparent 55%),
        radial-gradient(900px 600px at 80% 15%, rgba(123,211,255,.20), transparent 55%),
        radial-gradient(900px 700px at 70% 85%, rgba(255,216,107,.20), transparent 55%),
        linear-gradient(135deg, rgba(255,255,255,.55), rgba(255,255,255,.25));
      border: 1px solid rgba(255,255,255,.7);
      height: min(520px, 64vh);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    video{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      background: rgba(0,0,0,.12);
    }

    .videoOverlay{
      position:absolute;
      inset:auto 0 0 0;
      padding: 14px;
      background: linear-gradient(180deg, transparent, rgba(0,0,0,.45));
      color: white;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      min-height: 110px;
      pointer-events:none;
    }

    .badge{
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.25);
      border: 1px solid rgba(255,255,255,.35);
      backdrop-filter: blur(8px);
      font-weight:800;
      font-size: 12px;
      letter-spacing:.2px;
      white-space:nowrap;
    }

    .status{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.58);
      border:1px solid rgba(255,255,255,.72);
      font-size: 13px;
      opacity:.95;
    }
    .tinyNote{
      font-size: 12px;
      opacity: .85;
      margin-top: 10px;
      line-height: 1.6;
    }

    /* Message typing */
    .messageBox{
      padding: 14px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.62);
      border:1px solid rgba(255,255,255,.7);
      line-height: 1.9;
      font-size: 16px;
      min-height: 220px;
      white-space: pre-wrap;
    }
    .cursor{
      display:inline-block;
      width: 10px;
      height: 18px;
      background: rgba(255,63,159,.65);
      margin-left: 3px;
      border-radius: 3px;
      animation: blink .9s infinite;
      vertical-align: -3px;
    }
    @keyframes blink { 0%,49%{opacity:1} 50%,100%{opacity:.2} }

    /* Wishes */
    .wishTitle{
      text-align:center;
      font-family:"Pacifico", cursive;
      font-size: clamp(30px, 4vw, 50px);
      color:#ff3f9f;
      margin: 8px 0 10px;
    }
    .wishSub{
      text-align:center;
      margin:0 auto 14px;
      max-width: 680px;
      opacity:.9;
      line-height:1.75;
      background: rgba(255,255,255,.55);
      border:1px solid rgba(255,255,255,.65);
      padding: 12px 14px;
      border-radius: 16px;
    }

    .letters{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
    }
    @media (max-width: 860px){ .letters{grid-template-columns:1fr} }

    .letter{
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.7);
      background: rgba(255,255,255,.68);
      box-shadow: 0 16px 30px rgba(0,0,0,.08);
      position:relative;
    }
    .letterHeader{
      padding: 14px 14px 10px;
      background: linear-gradient(90deg, rgba(255,119,183,.22), rgba(123,211,255,.18), rgba(255,216,107,.18));
      border-bottom: 1px solid rgba(255,255,255,.75);
      font-weight: 900;
      display:flex; align-items:center; justify-content:space-between;
    }
    textarea{
      width:100%;
      border:0;
      outline:none;
      resize:none;
      padding: 12px 14px;
      font-family: inherit;
      font-size: 15.5px;
      line-height: 1.7;
      background: transparent;
      min-height: 160px;
    }

    /* Confetti canvas */
    canvas#confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index: 50;
      display:none;
    }
  </style>
</head>

<body>
  <div class="sparkle"></div>
  <canvas id="confetti"></canvas>

  <div class="wrap">
    <div class="frame">
      <div class="topbar">
        <div class="brand">
          <div class="dot"></div>
          <div>Birthday Surprise</div>
        </div>
        <div class="mini">
          <div class="pill">Nguy·ªÖn</div>
          <div class="pill">Tu·∫•n</div>
          <div class="pill">Anh ƒë·∫πp trai nh·∫•t</div>
        </div>
      </div>

      <div class="content">
        <!-- Screen 1 -->
        <section class="screen active" id="s1">
          <div class="hero oneCol">
            <div>
              <h1 class="title" id="greetTitle">Ch√†o em y√™u üíñ</h1>
              <p class="lead" id="greetText">
                H√¥m nay l√† ng√†y ƒë·∫∑c bi·ªát c·ªßa em. Anh chu·∫©n b·ªã m·ªôt m√≥n qu√† nh·ªè ‚Äî
                m·ªôt g√≥c ri√™ng ch·ªâ d√†nh cho t·ª•i m√¨nh.
                <br><br>
                Nh·∫•n ‚ÄúB·∫Øt ƒë·∫ßu‚Äù nh√© üòö
              </p>
              <div class="btnRow">
                <button class="btnPrimary" id="btnStart">B·∫Øt ƒë·∫ßu ‚ú®</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Screen 2 -->
        <section class="screen" id="s2">
          <div class="hero oneCol">
            <div>
              <h1 class="title">Em ƒë√£ s·∫µn s√†ng ch∆∞a? ü•∫</h1>
              <p class="lead">
                Anh mong em s·∫Ω th√≠ch m√≥n qu√† n√†y<br>
                iu em üíû
              </p>
              <div class="btnRow">
                <button class="btnPrimary" id="btnReady">S·∫µn s√†ng r·ªìi üíû</button>
                <button class="btnSoft" id="btnBack1">Quay l·∫°i</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Screen 3 (VIDEO) -->
        <section class="screen" id="s3">
          <div class="stage">
            <div class="videoWrap card">
              <video id="memoryVideo" playsinline controls preload="auto"></video>

              <div class="videoOverlay">
                <div>
                  <div style="font-family:Pacifico,cursive; font-size:20px; margin-bottom:4px;">T·ª•i m√¨nh üíó</div>
                  <div style="opacity:.9; font-size:13px" id="videoHint">N·∫øu video ch∆∞a ch·∫°y, h√£y b·∫•m n√∫t Play ‚ñ∂Ô∏è</div>
                </div>
                <div class="badge" id="videoBadge">VIDEO</div>
              </div>
            </div>

            <div class="card">
              <div class="pad">
                <div style="font-weight:900; font-size:16px; margin-bottom:10px;">ƒêang ph√°t‚Ä¶</div>
                <div class="status" id="playStatus">Chu·∫©n b·ªã b·∫Øt ƒë·∫ßu</div>
                <div class="tinyNote" id="videoNote">
                  N·∫øu video b·ªã d·ª´ng sau v√†i gi√¢y: h√£y export MP4 chu·∫©n <b>H.264 + AAC</b> (ƒë·ªÉ Chrome ch·∫°y ·ªïn).
                </div>
                <div class="btnRow" style="margin-top:12px">
                  <button class="btnGhost" id="btnSkip">B·ªè qua (v·∫´n y√™u) ‚ûú</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Screen 4 (Message) -->
        <section class="screen" id="s4">
          <div class="hero">
            <div>
              <h1 class="title">G·ª≠i em üíå</h1>
              <div class="messageBox" id="messageBox"></div>
              <div style="margin-top:14px" class="btnRow">
                <button class="btnPrimary" id="btnToWishes" disabled>Ti·∫øp t·ª•c ‚ûú</button>
              </div>
            </div>
            <div class="card">
              <div class="pad">
                <div style="font-weight:900; margin-bottom:10px;">Nh·∫Øn nh·ªè</div>
                <div style="line-height:1.7; opacity:.9">
                  Anh vi·∫øt ƒëo·∫°n n√†y ƒë·ªÉ em th·∫•y: em kh√¥ng ph·∫£i t·ª± g·ªìng m·ªôt m√¨nh.
                  M·ªçi th·ª© s·∫Ω ·ªïn d·∫ßn, v√† anh ·ªü ƒë√¢y.
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Screen 5 (Wishes) -->
        <section class="screen" id="s5">
          <h2 class="wishTitle">ƒêi·ªÅu ∆∞·ªõc c·ªßa em ‚ú®</h2>
          <p class="wishSub">
            H√¥m nay cho ph√©p em ‚Äú√≠ch k·ª∑‚Äù m·ªôt ch√∫t: h√£y vi·∫øt ra 2 ƒëi·ªÅu ∆∞·ªõc.
            Anh s·∫Ω ƒë·ªçc v√† c·ªë g·∫Øng th·ª±c hi·ªán cho em ‚Äî nghi√™m t√∫c ƒë√≥ üíõ
          </p>

          <div class="letters">
            <div class="letter">
              <div class="letterHeader">
                <span>‚úâÔ∏è B·ª©c th∆∞ #1</span>
                <span style="opacity:.8; font-size:12px">M·ªôt ƒëi·ªÅu ∆∞·ªõc</span>
              </div>
              <textarea id="wish1" placeholder="V√≠ d·ª•: Em mu·ªën‚Ä¶"></textarea>
            </div>

            <div class="letter">
              <div class="letterHeader">
                <span>‚úâÔ∏è B·ª©c th∆∞ #2</span>
                <span style="opacity:.8; font-size:12px">M·ªôt ƒëi·ªÅu ∆∞·ªõc n·ªØa</span>
              </div>
              <textarea id="wish2" placeholder="V√≠ d·ª•: Em mong‚Ä¶"></textarea>
            </div>
          </div>

          <div style="margin-top:14px" class="btnRow">
            <button class="btnPrimary" id="btnSend">G·ª≠i ƒëi·ªÅu ∆∞·ªõc üíå</button>
            <button class="btnSoft" id="btnSaveLocal">L∆∞u tr√™n m√°y (backup) üíæ</button>
          </div>

          <div class="status" id="sendStatus" style="margin-top:12px;">
            Tr·∫°ng th√°i: Ch∆∞a g·ª≠i.
          </div>

          <div class="tinyNote">
            ∆Ø·ªõc cho chi ti·∫øt z√¥ , khum l√† nh·ªãn üò§
          </div>
        </section>
      </div>
    </div>
  </div>

  <script>
    /***************
     * T√ôY CH·ªàNH NHANH
     ***************/
    const YOUR_NAME = "Anh";     // ƒë·ªïi th√†nh t√™n b·∫°n (v√≠ d·ª•: "Hi·∫øu")
    const HER_NICK  = "Em";      // ƒë·ªïi th√†nh t√™n/nickname c·ªßa c√¥ ·∫•y
    const VIDEO_SRC = "assets/vv.mp4"; // video c·ªßa b·∫°n
    const GOOGLE_SHEET_ENDPOINT = "https://script.google.com/macros/s/AKfycby2DEkYBiJ_CSV6xJWDdHP80ADSkO_-imWetkPvz501QWB9zZitFUpYDIJqGoArLGSozg/exec";

    const BIRTHDAY_MESSAGE =
`${HER_NICK} √†,
Th∆∞ ƒê·∫∑ng c·ªßa anhhhhhhhh
Ch√∫c m·ª´ng sinh nh·∫≠t em y√™uuuuuuuuuuuuuuu üíñ

Anh kh√¥ng mu·ªën ch√∫c em ki·ªÉu ‚Äúch√∫c vui v·∫ª‚Äù cho xong, v√¨ anh bi·∫øt d·∫°o n√†y trong em kh√¥ng ch·ªâ c√≥ ni·ªÅm vui.
C√≥ nh·ªØng ng√†y em ph·∫£i g·ªìng, ph·∫£i c·ªë t·ªè ra ·ªïn, ph·∫£i m·ªâm c∆∞·ªùi d√π b√™n trong r·ªëi nh∆∞ t∆°. C√≥ nh·ªØng l√∫c em m·ªát ƒë·∫øn m·ª©c ch·ªâ mu·ªën bi·∫øn m·∫•t kh·ªèi m·ªçi th·ª© m·ªôt ch√∫t, ho·∫∑c ch·ªâ mu·ªën ai ƒë√≥ n√≥i: ‚ÄúKh√¥ng sao, em kh√¥ng c·∫ßn c·ªë n·ªØa.‚Äù

Anh mu·ªën n√≥i v·ªõi em ƒëi·ªÅu n√†y, th·∫≠t r√µ r√†ng v√† th·∫≠t ch·∫≠m:

Em kh√¥ng h·ªÅ y·∫øu ƒëu·ªëi.
Em ƒëang ki·ªát s·ª©c v√¨ em ƒë√£ ph·∫£i ƒëi qua qu√° nhi·ªÅu th·ª© c√πng m·ªôt l√∫c ‚Äî m√† v·∫´n kh√¥ng b·ªè cu·ªôc.
Ng∆∞·ªùi y·∫øu l√† ng∆∞·ªùi bu√¥ng xu√¥i, c√≤n em‚Ä¶ em v·∫´n th·ª©c d·∫≠y, v·∫´n ƒëi l√†m, v·∫´n s·ªëng, v·∫´n c·ªë l√†m tr√≤n vai trong khi tr√°i tim th√¨ ch·∫≠t n√≠ch. ƒê√≥ kh√¥ng ph·∫£i ‚Äúb√¨nh th∆∞·ªùng‚Äù. ƒê√≥ l√† d≈©ng c·∫£m.

Anh c≈©ng mu·ªën em hi·ªÉu m·ªôt ƒëi·ªÅu quan tr·ªçng:
Kh√¥ng ai m·∫°nh m·∫Ω b·∫±ng c√°ch ‚Äúkh√¥ng ƒëau‚Äù.
M·∫°nh m·∫Ω l√† d√°m nh√¨n th·∫≥ng v√†o n·ªói ƒëau, d√°m th·ª´a nh·∫≠n ‚Äúem ƒëang m·ªát‚Äù, d√°m y·∫øu m·ªÅm m√† v·∫´n ti·∫øp t·ª•c s·ªëng t·ª≠ t·∫ø. Em l√†m ƒë∆∞·ª£c ƒëi·ªÅu ƒë√≥ m·ªói ng√†y, d√π em kh√¥ng nh·∫≠n ra.

N·∫øu c√≥ ƒëi·ªÅu g√¨ khi·∫øn em c·∫£m th·∫•y t·ªá‚Ä¶ anh kh√¥ng mu·ªën em t·ª± tr√°ch m√¨nh.
Stress, bu·ªìn b√£, m·∫•t ƒë·ªông l·ª±c, hay nh·ªØng l√∫c th·∫•y ƒë·ªùi v√¥ nghƒ©a ‚Äî n√≥ kh√¥ng n√≥i r·∫±ng em k√©m c·ªèi. N√≥ ch·ªâ n√≥i r·∫±ng em ƒë√£ ph·∫£i ch·ªãu ƒë·ª±ng qu√° l√¢u m√† ch∆∞a ƒë∆∞·ª£c ngh·ªâ ƒë√∫ng c√°ch, ch∆∞a ƒë∆∞·ª£c √¥m v√† th·∫£ l·ªèng ƒë√∫ng nghƒ©a.

N√™n h√¥m nay, sinh nh·∫≠t c·ªßa em, anh mu·ªën ‚Äúcho ph√©p‚Äù em m·ªôt ƒëi·ªÅu:
Em kh√¥ng c·∫ßn ph·∫£i m·∫°nh m·∫Ω su·ªët.
Em c√≥ th·ªÉ m·ªát. Em c√≥ th·ªÉ kh√≥c. Em c√≥ th·ªÉ kh√¥ng l√†m ƒë∆∞·ª£c g√¨ c·∫£.
Em c√≥ th·ªÉ ch·ªâ th·ªü v√† t·ªìn t·∫°i. Nh∆∞ v·∫≠y th√¥i c≈©ng ƒë√£ ƒë·ªß.

Anh ·ªü ƒë√¢y ‚Äî kh√¥ng ph·∫£i ki·ªÉu ‚Äú·ªü ƒë√¢y cho c√≥.‚Äù
Anh ·ªü ƒë√¢y ƒë·ªÉ ƒë·ª° em, ƒë·ªÉ nghe em, ƒë·ªÉ hi·ªÉu em v√† lu√¥n ch·ªù em v·ªÅ ƒë·ªÉ ƒë∆∞·ª£c ch·ªü che cho em

Anh ch·ªâ mong ƒë∆∞·ª£c ng·ªìi c·∫°nh em trong im l·∫∑ng, n·∫Øm tay em, ƒë·ªÉ em d·ª±a v√†o anh, ƒë·ªÉ em ƒë∆∞·ª£c ‚Äúngh·ªâ‚Äù m·ªôt ch√∫t trong v√≤ng tay anh.
Anh kh√¥ng c·∫ßn em ph·∫£i gi·∫£i th√≠ch h·ª£p l√Ω. Anh ch·ªâ c·∫ßn em ƒë∆∞·ª£c an to√†n v√† kh·ªèe m·∫°nh.

Th∆∞∆°ng em nhi·ªÅu ‚Äî kh√¥ng ph·∫£i ki·ªÉu th∆∞∆°ng m·ªôt l√∫c, m√† l√† th∆∞∆°ng m·ªói ng√†y.
V√† anh ch·ªçn em, m·ªói ng√†y. üíñ`;

    /***************
     * UI HELPERS
     ***************/
    const $ = (id) => document.getElementById(id);
    const screens = ["s1","s2","s3","s4","s5"].map($);
    function go(screenId){
      screens.forEach(s => s.classList.toggle("active", s.id === screenId));
      window.scrollTo({top:0, behavior:"smooth"});
    }

    $("greetTitle").textContent = `Ch√†o ${HER_NICK} y√™u üíñ`;
    $("greetText").innerHTML =
      `H√¥m nay l√† ng√†y ƒë·∫∑c bi·ªát c·ªßa ${HER_NICK}. ${YOUR_NAME} chu·∫©n b·ªã m·ªôt m√≥n qu√† nh·ªè ‚Äî m·ªôt g√≥c ri√™ng ch·ªâ d√†nh cho t·ª•i m√¨nh.
      <br><br>Nh·∫•n ‚ÄúB·∫Øt ƒë·∫ßu‚Äù nh√© üòö`;

    /***************
     * CONFETTI
     ***************/
    const confettiCanvas = $("confetti");
    const ctx = confettiCanvas.getContext("2d");
    let confettiOn = false;
    let confettiPieces = [];

    function resizeConfetti(){
      confettiCanvas.width = window.innerWidth * devicePixelRatio;
      confettiCanvas.height = window.innerHeight * devicePixelRatio;
      ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
    window.addEventListener("resize", resizeConfetti);
    resizeConfetti();

    function startConfetti(){
      confettiOn = true;
      confettiCanvas.style.display = "block";
      confettiPieces = Array.from({length: 140}, () => ({
        x: Math.random() * window.innerWidth,
        y: -20 - Math.random() * 200,
        r: 4 + Math.random() * 6,
        vx: -1.2 + Math.random() * 2.4,
        vy: 2.2 + Math.random() * 3.8,
        a: Math.random() * Math.PI * 2,
        va: -0.08 + Math.random() * 0.16
      }));
      requestAnimationFrame(tickConfetti);
      setTimeout(stopConfetti, 2600);
    }
    function stopConfetti(){
      confettiOn = false;
      setTimeout(()=>{ confettiCanvas.style.display = "none"; }, 600);
    }
    function tickConfetti(){
      if(!confettiOn) return;
      ctx.clearRect(0,0,window.innerWidth, window.innerHeight);
      confettiPieces.forEach(p=>{
        p.x += p.vx;
        p.y += p.vy;
        p.a += p.va;
        if(p.y > window.innerHeight + 30){ p.y = -20; p.x = Math.random()*window.innerWidth; }
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.a);
        const g = ctx.createLinearGradient(-p.r,0,p.r,0);
        g.addColorStop(0, "rgba(255,119,183,.9)");
        g.addColorStop(.5, "rgba(123,211,255,.85)");
        g.addColorStop(1, "rgba(255,216,107,.9)");
        ctx.fillStyle = g;
        ctx.fillRect(-p.r, -p.r, p.r*2, p.r*2);
        ctx.restore();
      });
      requestAnimationFrame(tickConfetti);
    }

    /***************
     * VIDEO
     ***************/
    const video = $("memoryVideo");
    let typed = false;

    function resetVideo(){
      try{
        video.pause();
        video.currentTime = 0;
      }catch(e){}
    }

    function loadVideo(){
      // d√πng src tr·ª±c ti·∫øp cho g·ªçn + ·ªïn ƒë·ªãnh
      video.src = VIDEO_SRC;
      video.load();
    }

    async function tryPlayVideo(){
      $("playStatus").textContent = "ƒêang ph√°t video‚Ä¶";
      try{
        await video.play();
        $("videoHint").textContent = "ƒêang ph√°t‚Ä¶";
      }catch(e){
        $("playStatus").textContent = "Ch∆∞a t·ª± ph√°t ƒë∆∞·ª£c. Em b·∫•m Play ‚ñ∂Ô∏è nha üíó";
        $("videoHint").textContent = "B·∫•m Play ‚ñ∂Ô∏è nh√©";
      }
    }

    function goMessage(){
      resetVideo();
      startConfetti();
      go("s4");
      typeMessage();
    }

    $("btnSkip").addEventListener("click", goMessage);

    video.addEventListener("ended", ()=>{
      $("playStatus").textContent = "K·∫øt th√∫c üíó";
      setTimeout(goMessage, 450);
    });

    video.addEventListener("play", ()=>{
      $("playStatus").textContent = "ƒêang ph√°t video‚Ä¶";
      $("videoHint").textContent = "ƒêang ph√°t‚Ä¶";
    });

    video.addEventListener("pause", ()=>{
      if ($("s3").classList.contains("active") && !video.ended) {
        $("playStatus").textContent = "ƒêang t·∫°m d·ª´ng. B·∫•m Play ‚ñ∂Ô∏è ƒë·ªÉ ti·∫øp t·ª•c.";
        $("videoHint").textContent = "B·∫•m Play ‚ñ∂Ô∏è ƒë·ªÉ ti·∫øp t·ª•c";
      }
    });

    video.addEventListener("stalled", ()=>{
      if ($("s3").classList.contains("active")) {
        $("playStatus").textContent = "Video b·ªã kh·ª±ng‚Ä¶ N·∫øu hay d·ª´ng, h√£y export MP4 H.264 + AAC.";
      }
    });

    video.addEventListener("error", ()=>{
      $("playStatus").textContent = "Kh√¥ng ph√°t ƒë∆∞·ª£c video (codec kh√¥ng h·ª£p). H√£y export MP4 H.264 + AAC nh√©.";
    });

    /***************
     * TYPEWRITER MESSAGE
     ***************/
    function typeMessage(){
      if(typed) return;
      typed = true;

      const box = $("messageBox");
      box.textContent = "";
      $("btnToWishes").disabled = true;

      const full = BIRTHDAY_MESSAGE;
      let i = 0;

      const cursor = document.createElement("span");
      cursor.className = "cursor";

      const tick = ()=>{
        if(i <= full.length){
          box.textContent = full.slice(0, i);
          box.appendChild(cursor);
          i += 1;
          const speed = (i < 30) ? 18 : (i < 240 ? 16 : 14);
          setTimeout(tick, speed);
        }else{
          cursor.remove();
          $("btnToWishes").disabled = false;
        }
      };
      tick();
    }

    /***************
     * WISH SENDING
     ***************/
    function getWishes(){
      return {
        wish1: $("wish1").value.trim(),
        wish2: $("wish2").value.trim(),
        createdAt: new Date().toISOString(),
      };
    }

    function saveLocal(){
      const data = getWishes();
      localStorage.setItem("birthday_wishes", JSON.stringify(data));
      $("sendStatus").textContent = "Tr·∫°ng th√°i: ƒê√£ l∆∞u backup tr√™n m√°y üíæ";
    }

    async function sendToSheet(){
      const data = getWishes();

      if(!data.wish1 && !data.wish2){
        $("sendStatus").textContent = "Tr·∫°ng th√°i: Em ch∆∞a vi·∫øt ƒëi·ªÅu ∆∞·ªõc n√†o h·∫øt üòö";
        return;
      }

      saveLocal();

      if(!GOOGLE_SHEET_ENDPOINT){
        $("sendStatus").textContent = "Tr·∫°ng th√°i: Ch∆∞a c√≥ link Google Sheet ‚Äî ƒë√£ backup tr√™n m√°y üíæ";
        return;
      }

      try{
        $("sendStatus").textContent = "Tr·∫°ng th√°i: ƒêang g·ª≠i‚Ä¶ ‚è≥";

        // G·ª≠i d·∫°ng FORM ƒë·ªÉ tr√°nh l·ªói CORS/preflight
        const form = new URLSearchParams();
        form.append("wish1", data.wish1);
        form.append("wish2", data.wish2);
        form.append("createdAt", data.createdAt);

        await fetch(GOOGLE_SHEET_ENDPOINT, {
          method: "POST",
          body: form,
          mode: "no-cors"
        });

        $("sendStatus").textContent = "Tr·∫°ng th√°i: ƒê√£ g·ª≠i! Anh s·∫Ω th·∫•y trong Google Sheet üíå";
        startConfetti();
      }catch(err){
        $("sendStatus").textContent = "Tr·∫°ng th√°i: G·ª≠i l·ªói (nh∆∞ng ƒë√£ backup tr√™n m√°y) üôà";
      }
    }

    $("btnSend").addEventListener("click", sendToSheet);
    $("btnSaveLocal").addEventListener("click", saveLocal);

    // load backup if any
    try{
      const raw = localStorage.getItem("birthday_wishes");
      if(raw){
        const data = JSON.parse(raw);
        if(data.wish1) $("wish1").value = data.wish1;
        if(data.wish2) $("wish2").value = data.wish2;
      }
    }catch(e){}

    /***************
     * NAV BUTTONS
     ***************/
    $("btnStart").addEventListener("click", ()=> go("s2"));
    $("btnBack1").addEventListener("click", ()=> go("s1"));

    $("btnReady").addEventListener("click", async ()=>{
      go("s3");
      loadVideo();
      await tryPlayVideo();
    });

    $("btnToWishes").addEventListener("click", ()=>{
      go("s5");
      startConfetti();
    });
  </script>
</body>
</html>
